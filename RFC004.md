# RFC0004

## Title
APIs for Flexible Allocation Support

## Abstract
A brief description of the proposed change.

## Labels
[EXTENSION]

## Action

## Copyright Notice
This document is subject to all provisions relating to code contributions to the PMIx community as defined in the community's [LICENSE](https://github.com/pmix/RFCs/tree/master/LICENSE) file. Code Components extracted from this document must include the License text as described in that file.

## Description
There is one proposed new API, with an accompanying new callback function:

* typedef void (*pmix_request_cbfunc_t)(pmix_status_t status,
                                        pmix_info_t *details, size_t ndetails,
                                        void *your_cbdata,
                                        pmix_release_cbfunc_t release_fn,
                                        void *release_cbdata);

* PMIx_Allocation_request(char *directive, pmix_info_t *info, size_t ninfo,
                          pmix_request_cbfunc_t cbfunc, void *cbdata);

New attributes for directives:

* PMIX_ALLOCATE_NEW - new allocation is being requested. The resulting allocation will be disjoint (i.e., not connected in a job sense) from the requesting allocation
* PMIX_ALLOCATE_EXTEND - extend the existing allocation
* PMIX_ALLOCATE_RELEASE - release part of the existing allocation

Attributes to describe resources:

* PMIX_NUM_NODES - (uint32_t) number of nodes
* PMIX_NODE_LIST - (string) regex of specific nodes
* PMIX_NUM_CPUS - (uint32_t) number of cpus
* PMIX_NUM_CPU_LIST - (string) comma-separated list of #cpus for each node
* PMIX_CPU_LIST - (string) regex of specific cpus that indicates the cpus involved. If not given as part of an info struct that identifies the impacted nodes, then the cpu description will be applied across all nodes in the requestor's allocation
* PMIX_MEM_SIZE - (uint32_t) number of megabytes
* PMIX_NETWORK - (array) array of pmix_info_t describing the network resources. If not given as part of an info struct that identifies the impacted nodes, then the description will be applied across all nodes in the requestor's allocation
* PMIX_NETWORK_ID - (string) name of network
* PMIX_BANDWIDTH - (float) Megabits/sec
* PMIX_NETWORK_QOS - (string) Quality of service level

Requests will use arrays of attributes to fully describe the request - each info key might contain the following:

PMIX_NETWORK -> value: array
                -> info[0].key = PMIX_NETWORK_ID
                   info[0].value = "eth0"
                -> info[1].key = PMIX_BANDWIDTH
                   info[1].value = 1.386

PMIX_CPUS -> value: array
                -> info[0].key = PMIX_NODE_LIST
                   info[0].value = "foo1,foo2"
                -> info[1].key = PMIX_NUM_CPU_LIST
                   info[1].value = "5,3"   // indicates a request for 5 cpus on foo1, 3 cpus on foo2


## Protoype Implementation
Provide a reference link to the accompanying Pull Request (PR) against the PMIx master repository. If the prototype implementation has been tested against an appropriately modified resource manager and/or client program, then references to those prototypes should be provided. Note that approval of any RFC will be far more likely to happen if such validation has been performed!

## Author(s)
Ralph H. Castain
Intel, Inc.
Github: rhc54
